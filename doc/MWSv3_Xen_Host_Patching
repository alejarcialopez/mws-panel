==Introduction==

In general, you can just patch the xen hosts in the usual manner of <code>apt-get update && apt-get dist-upgrade</code>; for more disruptive patches (e.g. for security issues in linux or Xen), where you need to reboot, it's important to make sure there aren't guests running on the host before rebooting it!

So, do this to each Xen host in turn:

# <code>crm_mon -1</code>
#* check for any errors and make sure they won't cause trouble
#* specifically, if a resource has errors on one node, Pacemaker may stop it rather than trying again to run it on that node
#* <code>crm resource cleanup</code> is probably helpful here
# Adjust the scores of the two nodes to deprioritise the one you're patching (e.g. to patch agogue):
#* <code>crm node attribute agogue set node-score 0</code>
#* <code>crm node attribute odochium set node-score 100</code>
#* you can use <code>crm_mon</code> to monitor the location of guests, also the relevant quorum server's web-version
#* <code>xl list</code> will show only Domain-0 once this process is complete
# <code>apt-get update && apt-get dist-upgrade</code>
# reboot
#* <code>shutdown -r now 'useful message'</code> or similar
#* if you want, visit the machine's virtual console to observe the reboot cycle (the hardware takes a while to reboot)
#* check things are happy with <code>systemctl status</code> and <code>drbd-overview</code>
# Re-adjust node scores:
#* <code>crm node attribute odochium set node-score 0</code>
#* This should cause Pacemaker to rebalance the VMs between the nodes.

If you want to move a small number of guests back to the patched machine to test it you can do so by setting a location constraint for that guest with a score higher than 100. You have to do this by editing the running CRM configuration (e.g. to push mws-priv-30 back to agogue):
<pre>
# crm configure
crm(live)configure# edit
...using the editor, add a line 'location temp mws-priv-7 200: agogue' and save the result...
crm(live)configure# verify
crm(live)configure# commit
crm(live)configure# quit
</pre>
Re-edit the configuration to remove the rule when you have finished.