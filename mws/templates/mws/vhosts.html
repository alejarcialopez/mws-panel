{% extends 'project-light/campl-mws.html' %}
{% load static %}
{% block page_content %}
    <script>
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function delete_vhost(url) {
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function(result) {
                    location.reload();
                },
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
                },
                crossDomain: false
            });
        }
    </script>

    <div class="campl-column12 campl-main-content">
        <div class="campl-content-container">

            <h1>Domain names for the mws "{{ site.name }}"</h1>
            <table class="campl-table-bordered campl-table-striped campl-table campl-vertical-stacking-table">
                <thead>
                    <tr>
                        <th>Vhost</th>
                        <th>Domains</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                {% for vhost in site.vhosts.all %}
                    <tr>
                        <td>
                            {{ vhost.name }}
                        </td>
                        <td>
                            {% for domain_name in vhost.sorted_domain_names %}
                                {{ domain_name.name }},
                            {% endfor %}
                        </td>
                        <td style="width: 160px;">
                            <a href="{% url 'sitesmanagement.views.domains_management' vhost_id=vhost.id %}">
                                <i title="Domains associated to this vhost" class="fa fa-link fa-2x"></i>
                            </a>
                            <a href="{% url 'sitesmanagement.views.certificates' vhost_id=vhost.id %}">
                                <i title="TLS/SSL" class="fa fa-lock fa-2x"></i>
                            </a>
                            <a class="delete_vhost" data-toggle="confirmation" data-href="javascript:delete_vhost('{% url 'sitesmanagement.views.delete_vhost' vhost_id=vhost.id %}')" href="#">
                                <i title="Delete" class="fa fa-trash-o fa-2x"></i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

        <p><a href={% url 'sitesmanagement.views.add_vhost' site_id=site.id %} class="campl-primary-cta">Add a new vhost</a></p>

        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('[data-toggle="confirmation"]').confirmation({singleton:true, popout:true});
        })

    </script>
{% endblock %}
