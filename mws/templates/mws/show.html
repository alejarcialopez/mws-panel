{% extends 'project-light/campl-mws.html' %}
{% load static %}
{% block page_content %}
    <div class="view view-focus-on view-id-focus_on view-display-id-page">
        <div class="view-header">
            <div class="campl-content-container"></div>
        </div>

        <div class="view-content">

            {% if warning_messages %}
            <div class="campl-column12">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser
                                    campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-txt">
                            <div style="padding: 20px; color: white">
                                <h2 style="color: white">Messages:</h2>
                                <ul>
                                    {% for message in warning_messages %}
                                        <li>{{ message }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
            {% endif %}

        {% if site.production_service and site.production_service.active and not site.production_service.is_busy %}

            {% if site.production_service %}
            <div class="campl-column4">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.production_service.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid" src="{% static "icons/settings-3.png" %}" height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.production_service.id %}">
                                        MWS server settings
                                    </a>
                                </h3>
                                <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.production_service.id %}" class="ir campl-focus-link">MWS server settings</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
            {% endif %}

            <div class="campl-column4">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'editsite' site_id=site.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid" src="{% static "icons/pencil.png" %}" height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'editsite' site_id=site.id %}">
                                        Edit the MWS profile
                                    </a>
                                </h3>
                                <a href="{% url 'editsite' site_id=site.id %}" class="ir campl-focus-link">Edit the MWS profile</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            <div class="campl-column4">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'mwsauth.views.auth_change' site_id=site.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid" src="{% static "icons/person.png" %}" height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'mwsauth.views.auth_change' site_id=site.id %}">
                                        Manage authorised users and groups
                                    </a>
                                </h3>
                                <a href="{% url 'mwsauth.views.auth_change' site_id=site.id %}"
                                   class="ir campl-focus-link">Manage authorised users and groups</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            {% if site.is_ready %}

            <div class="campl-column4{% if DEMO %} not-active{% endif %}">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix
                                    campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'sitesmanagement.views.clone_vm_view' site_id=site.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image
                                                field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid"
                                                     src="{% static "icons/cloud-1.png" %}"
                                                     height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'sitesmanagement.views.clone_vm_view' site_id=site.id %}">
                                        Manage production and test servers
                                    </a>
                                </h3>
                                <a href="{% url 'sitesmanagement.views.clone_vm_view' site_id=site.id %}"
                                   class="ir campl-focus-link">Manage production and test servers</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            {% else %}

            <div class="campl-column4{% if DEMO %} not-active{% endif %}">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix
                                    campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <div class="field field-name-field-external-url-image field-type-image
                                            field-label-hidden">
                                    <div class="field-items">
                                        <div class="field-item even">
                                            <img class="campl-scale-with-grid"
                                                 src="{% static "icons/cloud-1.png" %}"
                                                 height="128" style="margin: 10px;" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title" style="color: orangered">
                                    Manage production and test servers (disabled while any of the servers are being configured)
                                </h3>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            {% endif %}

        {% endif %}

        {% if site.test_service and site.test_service.active and not site.test_service.is_busy %}
            <div class="campl-column4 campl-theme-3">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix
                                    campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.test_service.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image
                                                field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid"
                                                     src="{% static "icons/settings-1.png" %}"
                                                     height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.test_service.id %}">
                                        MWS test server settings
                                    </a>
                                </h3>
                                <a href="{% url 'sitesmanagement.views.service_settings' service_id=site.test_service.id %}"
                                   class="ir campl-focus-link">MWS test server settings</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        {% endif %}

            <div class="campl-column4">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="http://test.dev.mws3.csx.cam.ac.uk:3000/dashboard/script/mws3.js?name={{ stats_name }}">
                                    <div class="field field-name-field-external-url-image field-type-image field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid" src="{% static "icons/system-analytics.png" %}" height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="http://test.dev.mws3.csx.cam.ac.uk:3000/dashboard/script/mws3.js?name={{ stats_name }}">System analytics</a>
                                </h3>
                                <a href="http://test.dev.mws3.csx.cam.ac.uk:3000/dashboard/script/mws3.js?name={{ stats_name }}" class="ir campl-focus-link">System analytics</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            <div class="campl-column4">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div class="campl-focus-teaser-img">
                            <div class="campl-content-container campl-horizontal-teaser-img">
                                <a href="{% url 'sitesmanagement.views.billing_management' site_id=site.id %}">
                                    <div class="field field-name-field-external-url-image field-type-image field-label-hidden">
                                        <div class="field-items">
                                            <div class="field-item even">
                                                <img class="campl-scale-with-grid" src="{% static "icons/case.png" %}" height="128" style="margin: 10px;" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="campl-focus-teaser-txt">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <h3 class="campl-teaser-title">
                                    <a href="{% url 'sitesmanagement.views.billing_management' site_id=site.id %}">Billing settings</a>
                                </h3>
                                <a href="{% url 'sitesmanagement.views.billing_management' site_id=site.id %}" class="ir campl-focus-link">Billing settings</a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            <div class="campl-column8">
                <div class="campl-content-container campl-side-padding">
                    <article class="node node-external-link view-mode-focus_on clearfix
                                    campl-horizontal-teaser campl-teaser campl-focus-teaser">
                        <div style="width: 50%; float: left; margin-right: 0; padding: 0;">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <a>
                                    Production server<br/>
                                    IPv4: {{ site.production_service.ipv4 }}<br/>
                                    IPv6: {{ site.production_service.ipv6 }}<br/>
                                    hostname: {{ site.production_service.hostname }}<br/>
                                    hostkey fingerprint: {{ site.production_service.sshfp }}<br/>
                                </a>
                            </div>
                        </div>
                        <div style="width: 50%; float: left; margin-right: 0; padding: 0;">
                            <div class="campl-content-container campl-horizontal-teaser-txt">
                                <a>
                                    {% if site.test_service %}
                                    Test server<br/>
                                    IPv4: {{ site.test_service.ipv4 }}<br/>
                                    hostname: {{ site.test_service.hostname }}<br/>
                                    hostkey fingerprint: {{ site.test_service.sshfp }}<br/>
                                    {% endif %}
                                </a>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resend_email_modal" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">Email confirmation</h4>
                </div>
                <div class="modal-body">
                    <p>The confirmation email has been resent</p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block campl_foot_js %}
    <script>
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function ajax_call(url, type) {
            $.ajax({
                url: url,
                type: type,
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
                },
                crossDomain: false
            });
        }

        $('#resend_email_link').click(function() {
            $('#resend_email_modal').modal();
            ajax_call($("#resend_email_link").attr('data-href'), 'POST');
        });
    </script>
{% endblock %}
